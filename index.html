<script>
  // === CONFIG ===
  const AMAZON_TAG = 'luxeora2025-21';
  const ALI_ID = 'TU_ID_ALIEXPRESS';

  // === TUS PRODUCTOS (ejemplo) ===
  const PRODUCTS = [
    { id:'amz-echo-dot', name:'Echo Dot (5ª Gen)', price:59.99, category:'Electrónica', rating:4.6, merchant:'amazon', asin:'B09B8X9RGM', image:'https://m.media-amazon.com/images/I/61g8zR1GJHL._AC_SL1000_.jpg' },
    { id:'amz-instant-pot', name:'Instant Pot Duo 7-in-1 (5.7 L)', price:79.99, category:'Hogar', rating:4.7, merchant:'amazon', asin:'B08Z4HCGDH', image:'https://m.media-amazon.com/images/I/81-+tHUPQ5L._AC_SL1500_.jpg' },
    { id:'amz-airpods', name:'Apple AirPods Pro (2ª Gen)', price:249.00, category:'Electrónica', rating:4.8, merchant:'amazon', asin:'B0BDJH6GL8', image:'https://m.media-amazon.com/images/I/61SUj2aKoEL._AC_SL1500_.jpg' }
  ];

  // === HELPERS ===
  function amazonUrl(asin){ return `https://www.amazon.es/dp/${asin}?tag=${AMAZON_TAG}` }
  function aliUrl(ref){ return `https://s.click.aliexpress.com/e/${ref}?aff_short_key=${ALI_ID}` }

  function starRow(r){
    const full = Math.round(r); let s='';
    for(let i=1;i<=5;i++){ s += `<span aria-hidden="true">${i<=full?'★':'☆'}</span>` }
    return `<span title="${r.toFixed(1)} / 5">${s} <small class="muted">${r.toFixed(1)}</small></span>`
  }

  function card(p){
    const url = p.merchant==='amazon' ? amazonUrl(p.asin) : aliUrl(p.aliRef);
    return `
      <article class="card">
        <img src="${p.image}" alt="${p.name}">
        <div class="pad">
          <div class="row">
            <h3 style="margin:0;font-size:16px">${p.name}</h3>
            <div class="price">€${p.price.toFixed(2)}</div>
          </div>
          <div class="row" style="margin:6px 0 10px">${starRow(p.rating)}<span class="tag">${p.merchant==='amazon'?'Amazon':'AliExpress'}</span></div>
          <div class="row">
            <span class="tag">${p.category}</span>
            <a class="btn" href="${url}" target="_blank" rel="noopener nofollow">Comprar ▶</a>
          </div>
        </div>
      </article>`;
  }

  // === RENDER + DEBUG ===
  function render(list){
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    grid.innerHTML = list.map(card).join('');
    empty.style.display = list.length ? 'none' : 'block';
    console.log(`Rendered ${list.length} products`, list);
    // badge de conteo visible
    let badge = document.getElementById('count-badge');
    if (!badge) {
      badge = document.createElement('div');
      badge.id = 'count-badge';
      badge.style.cssText = 'position:fixed;right:12px;bottom:12px;background:#7c3aed;color:#fff;padding:8px 10px;border-radius:12px;font:12px/1.2 system-ui;z-index:9999';
      document.body.appendChild(badge);
    }
    badge.textContent = `Productos: ${list.length}`;
  }

  function apply(state){
    const list = PRODUCTS.filter(p=>{
      const catOk = state.cat==='Todos' || p.category===state.cat;
      const qOk = !state.q || p.name.toLowerCase().includes(state.q.toLowerCase());
      const mOk = (!state.onlyAmazon && !state.onlyAli) || (state.onlyAmazon && p.merchant==='amazon') || (state.onlyAli && p.merchant==='aliexpress');
      return catOk && qOk && mOk;
    });
    render(list);
  }

  // === START ===
  document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM listo, productos cargados:', PRODUCTS.length);
    const pills = Array.from(document.querySelectorAll('.pill'));
    const q = document.getElementById('q');
    const onlyAmazon = document.getElementById('onlyAmazon');
    const onlyAli = document.getElementById('onlyAli');

    const state = { cat:'Todos', q:'', onlyAmazon:false, onlyAli:false };

    pills.forEach(el=>{
      el.addEventListener('click',()=>{
        pills.forEach(p=>p.classList.remove('active'));
        el.classList.add('active');
        state.cat = el.dataset.cat;
        apply(state);
      });
    });
    q.addEventListener('input',()=>{ state.q = q.value; apply(state); });
    onlyAmazon.addEventListener('change',()=>{ state.onlyAmazon = onlyAmazon.checked; if(onlyAmazon.checked){ onlyAli.checked=false; state.onlyAli=false;} apply(state); });
    onlyAli.addEventListener('change',()=>{ state.onlyAli = onlyAli.checked; if(onlyAli.checked){ onlyAmazon.checked=false; state.onlyAmazon=false;} apply(state); });

    // Primer render
    apply(state);
  });
</script>
